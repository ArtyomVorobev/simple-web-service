# simple-web-service
Simple web service with html markup
Веб-сервис реализован с помощью фреймворка FastAPI (https://fastapi.tiangolo.com/).
В данном веб-сервисе реализованы следующие задачи (все модели обучены на английском языке):
1. Emotion classification на основе языковой модели BERT
2. Image-text-recognition на основе фреймворка easyocr
3. similar-texts-recognition на основе SentenceTransformers модели 

HTML разметка добавлена для первых двух задач,а для третьей только один POST эндпоинт. 
Чтобы запустить веб-сервис, нужно, находясь в папке с проектом, в консоли написать следующую команду: uvicorn main:app --reload

Далее перейти по ссылке http://127.0.0.1:8000. Там выбираем нужную нам задачу.
![1](https://user-images.githubusercontent.com/66844229/145725994-8ceabf9d-8b54-47e4-9f5c-220157b70386.PNG)

Чтобы протестировать третью задачу переходим по ссылке http://127.0.0.1:8000/docs, там выбираем similar-text-recognition
![2](https://user-images.githubusercontent.com/66844229/145725997-1f45bc24-4caa-4a0e-98dc-a32685f65fa1.PNG)

Далее нажимаем кнопку try it out
![3](https://user-images.githubusercontent.com/66844229/145726009-da78e244-6e17-43bb-a074-2fb24c482165.PNG)

Вводим нужные тексты в формы для ввода и нажимаем EXECUTE 
![4](https://user-images.githubusercontent.com/66844229/145726012-6d6f1528-3129-4da0-9574-dd50bf43fd52.PNG)


Получаем значение косинусного расстояния в Response body 
![5](https://user-images.githubusercontent.com/66844229/145726017-abea84a8-9a98-433d-bcf0-ccf3e480eb9f.PNG)


# Про модели

1. Для первой задачи я выбрал предобученную модель https://huggingface.co/bhadresh-savani/distilbert-base-uncased-emotion.
Реализация находится в файле emotion_model.py. Сначала текст токенизируется с помощью предобученного для этой же модели токенизатора, потом подается на вход модели, которая выдает вероятности классов ( "sadness","joy","love","anger","fear","surprise"). В Response body получаем класс с максимальной вероятностью, а также вероятности остальных классов.

2.Для второй предобученную на английском языке модель с фреймворка easyocr. На вход модели подается PIL Image. На выходе получаем надписи и координаты, в которых находится конкретный текст. Далее картинка и аутпут модели подается на вход функции get_image() реализованной в ocr_model.py. Функция сохраняет картинку, на которой будут написаны тексты, которые предсказала модель. В Response body получаем предсказанный текст.

!!! Для корректной работы нужно будет изменить директорию сохранения результирующей картинки в main.py (изменить save_path), а также для отображения в браузере изменить в HTML шаблоне значение img src (/templates/itr_result_form.html)!!!

3. Для третьей предобученную модель bert-base-nli-mean-tokens, а в качестве меры схожести текстов выбрал косинусное расстояние, которое считал по формуле 

![cosine](https://user-images.githubusercontent.com/66844229/145726046-d5c145a7-1ed5-41be-b939-a66771669d59.png)


Модель Принимает на вход текст, а на выходе отдает эмбеддинг нашего текста размерности 768*1. Далее считается косинусное расстояние между данными векторами  обоих текстов. В Response body получаем значение косинусного расстояния.


# P.S. 
HTML шаблоны находятся в папке /templates

